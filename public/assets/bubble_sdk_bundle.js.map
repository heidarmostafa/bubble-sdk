{"version":3,"sources":["webpack:///webpack/bootstrap 4271232f4c11816a1eca","webpack:///./~/soda-sandbox/soda_sandbox.js","webpack:///./src/bubble_sdk.js?a4c9","webpack:///./src/bubble_sdk.js","webpack:///./src/SodaMessage.class.js","webpack:///./src/utils.js"],"names":[],"mappings":";AAAA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,uBAAe;AACf;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;;;;;;;;;;;;;;ACtCA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA,4EAA2E,UAAU;AACrF;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,cAAa;AACb;AACA;AACA,kBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA,cAAa;AACb;AACA;AACA;AACA;AACA,cAAa;AACb;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA,iGAAgG;AAChG;AACA;AACA,0BAAyB;AACzB;AACA,kBAAiB;AACjB;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,cAAa;AACb;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,UAAS;AACT;AACA;AACA;;AAEA;AACA;AACA;AACA,UAAS;AACT;AACA;AACA;;AAEA;AACA;AACA;AACA,oCAAmC;AACnC;AACA;AACA;AACA;AACA;AACA,UAAS;AACT;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,cAAa;AACb,UAAS;AACT,sBAAqB;AACrB;AACA,4BAA2B;AAC3B;AACA,kBAAiB;AACjB,cAAa;AACb;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,cAAa;AACb,UAAS;AACT,sBAAqB;AACrB;AACA,4BAA2B;AAC3B;AACA,kBAAiB;AACjB,cAAa;AACb;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA,8BAA6B,sBAAsB;AACnD;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,oBAAmB;AACnB;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,8BAA6B,0BAA0B;AACvD;;AAEA;AACA;AACA,+BAA8B;AAC9B;;AAEA;AACA;AACA;AACA,8BAA6B,sBAAsB;AACnD;;AAEA;AACA,kBAAiB,UAAU,mBAAmB;AAC9C;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,cAAa;AACb;AACA;AACA;AACA;AACA,cAAa;AACb;AACA;AACA;AACA;AACA,uCAAsC;;AAEtC;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kBAAiB;AACjB;AACA;AACA,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,cAAa;AACb;AACA,UAAS;AACT;;AAEA;AACA;AACA;AACA;AACA,UAAS;AACT;AACA;AACA;AACA;AACA,kBAAiB;AACjB;AACA;AACA;;AAEA;AACA;AACA;AACA,kGAAiG,cAAc;AAC/G;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;;;;;;AC7YA,2GAA2K,E;;;;;;;ACA3K;;;;AAEA;;AACA;;;;;;AAEA;AACA,QAAO,OAAP;AACI,0BAAc;AAAA;AAAE;;AADpB;AAAA;AAAA,gDA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","file":"bubble_sdk_bundle.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/public/assets/\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n/** WEBPACK FOOTER **\n ** webpack/bootstrap 4271232f4c11816a1eca\n **/","var windowsObjectReference = {};\r\n\r\nfunction SodaSandbox() {\r\n\r\n    var me = {};\r\n    var contacts = [];\r\n    var userPictures = {};\r\n    var location = null;\r\n    var sessionId = \"\";\r\n    var conversationId = \"\";\r\n    var payloads = {};\r\n    var that = this;\r\n    var storage = localStorage;\r\n\r\n    function getMyUrl(){\r\n        return window.location.href\r\n    }\r\n\r\n    function receiveMessageFromOtherWindow(event)\r\n    {\r\n        // Do we trust the sender of this message?\r\n        if (event.origin !== window.location.origin)\r\n            return;\r\n\r\n        windowsObjectReference[event.data] = event.source;\r\n    }\r\n\r\n    window.addEventListener(\"message\", receiveMessageFromOtherWindow, false);\r\n\r\n    function getURLParameter(name) {\r\n        var where = (window.location.search === \"\") ? window.location.hash : window.location.search;\r\n        return decodeURIComponent((new RegExp('[?|&]' + name + '=' + '([^&;]+?)(&|#|;|$)').exec(where)||[,\"\"])[1].replace(/\\+/g, '%20'))||null;\r\n    }\r\n\r\n    function createUrl(url, newSessionId, newUserId, newConversationId) {\r\n        var result = null;\r\n        if (url && newSessionId && newUserId && newConversationId) {\r\n            //var loc = url.indexOf('sessionId=');\r\n            if (getURLParameter('sessionId')) {\r\n                result = url.replace(/(sessionId=)[^&]+/, '$1' + newSessionId);\r\n            } else {\r\n                if (url.indexOf('?') > -1) {\r\n                    result = url + \"&sessionId=\" + newSessionId;\r\n                } else {\r\n                    result = url + \"?sessionId=\" + newSessionId;\r\n                }\r\n            }\r\n            if (getURLParameter('userId')) {\r\n                result = result.replace(/(&userId=)[^&]+/, '$1' + newUserId);\r\n            } else {\r\n                result += \"&userId=\" + newUserId;\r\n            }\r\n            if (getURLParameter('conversationId')) {\r\n                result = result.replace(/(&conversationId=)[^&]+/, '$1' + newConversationId);\r\n            } else {\r\n                result += \"&conversationId=\" + newConversationId;\r\n            }\r\n        }\r\n        return result;\r\n    }\r\n\r\n    function saveMessage(metadata, isLocal) {\r\n        var jsonData = decryptMsg(metadata);\r\n\r\n        function storeUserPayload(userId) {\r\n            var storageItem = decryptMsg(storage.getItem('SODA_ITEM'));\r\n            if (storageItem === null) {\r\n                storageItem = {};\r\n            } else {\r\n                storage.removeItem('SODA_ITEM');\r\n            }\r\n            if (!storageItem.hasOwnProperty(sessionId)){\r\n                storageItem[sessionId] = {};\r\n            }\r\n            storageItem[sessionId][userId] = jsonData.payload;\r\n            storageItem[sessionId]['whoChanged'] = userId;\r\n            storage.setItem(\"SODA_ITEM\", encryptMsg(storageItem));\r\n        }\r\n\r\n        if (jsonData !== null && jsonData.sessionId && jsonData.sessionId !== \"\") {\r\n            sessionId = jsonData.sessionId;\r\n            storage.setItem(\"SODA_LAST_SESSION\", sessionId);\r\n\r\n            var url = (typeof jsonData.bubbleAppUrl === \"undefined\") ? getMyUrl(): decodeURIComponent(jsonData.bubbleAppUrl);\r\n\r\n            if (isLocal) {\r\n                payloads[sessionId] = jsonData.payload;\r\n                storeUserPayload(me.userId);\r\n                if (!getURLParameter('sessionId')) {\r\n                    history.pushState(\"Rewriting URL to add params\", \"localPage\", createUrl(url, sessionId, me.userId, conversationId));\r\n                }\r\n\r\n            } else {\r\n                contacts.forEach(function(elem){\r\n                    storeUserPayload(elem.userId);\r\n                    if (!windowsObjectReference.hasOwnProperty(elem.userId) || windowsObjectReference[elem.userId].closed) {\r\n                        /* if the pointer to the window object in memory does not exist\r\n                         or if such pointer exists but the window was closed */\r\n                        var fullUrl = createUrl(url, sessionId, elem.userId, conversationId);\r\n                        windowsObjectReference[elem.userId] = window.open(fullUrl, elem.userId); // The second param will cause it to only open in new tab if it doesn't exist.\r\n                        setTimeout(function() {\r\n                            windowsObjectReference[elem.userId].postMessage(me.userId, fullUrl);\r\n                        }, 3000);\r\n                    }\r\n                });\r\n            }\r\n        }\r\n    }\r\n\r\n    addEventListener('storage', storageListenerFunc);\r\n\r\n    function storageListenerFunc(event) {\r\n        if (event.key === \"SODA_ITEM\" && event.newValue) {\r\n            if (typeof setPayload === 'function') {\r\n                var newVal = decryptMsg(event.newValue);\r\n                if (newVal && newVal[sessionId] && newVal[sessionId]['whoChanged'] === me.userId) {\r\n                    setPayload(newVal[sessionId][me.userId]);\r\n                }\r\n            } else {\r\n                console.log('no setPayload function declared');\r\n            }\r\n        }\r\n    }\r\n\r\n    function decryptMsg(msg) {\r\n        try {\r\n            return JSON.parse(msg)\r\n        } catch (ex) {\r\n            return null;\r\n        }\r\n    }\r\n\r\n    function encryptMsg(msg) {\r\n        try {\r\n            return JSON.stringify(msg)\r\n        } catch (ex) {\r\n            return null;\r\n        }\r\n    }\r\n\r\n    function generateUUID() {\r\n        var d = new Date().getTime();\r\n        if (window.performance && typeof window.performance.now === \"function\") {\r\n            d += performance.now(); //use high-precision timer if available\r\n        }\r\n        return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {\r\n            var r = (d + Math.random() * 16) % 16 | 0;\r\n            d = Math.floor(d / 16);\r\n            return (c == 'x' ? r : (r & 0x3 | 0x8)).toString(16);\r\n        });\r\n    }\r\n\r\n    function errorMsgGenerator(err) {\r\n        try {\r\n            return JSON.stringify({\r\n                \"success\": false,\r\n                \"result\": {\r\n                    \"errorId\": err\r\n                }\r\n            });\r\n        } catch (e) {\r\n            return '{ \\\r\n                \"success\": false,\\\r\n                \"result\": {\\\r\n                \"errorId\": \"bad parameter to function\"\\\r\n                }\\\r\n            }'\r\n        }\r\n    }\r\n\r\n    function msgGenerator(content) {\r\n        try {\r\n            return JSON.stringify({\r\n                \"success\": true,\r\n                \"result\": content\r\n            });\r\n        } catch (e) {\r\n            return '{ \\\r\n                \"success\": false,\\\r\n                \"result\": {\\\r\n                \"errorId\": \"bad parameter to function\"\\\r\n                }\\\r\n            }'\r\n        }\r\n\r\n    }\r\n\r\n    function getUserPic(userId) {\r\n        if (userPictures.hasOwnProperty(userId)) {\r\n            return userPictures[userId];\r\n        }\r\n        return null;\r\n    }\r\n\r\n    //////////////////// PUBLIC METHODS ///////////////////////////////////////\r\n\r\n    ////////////// SDK functions start: ///////////////////////////////////////\r\n\r\n    this.sendMessage = function(metadata) {\r\n        saveMessage(metadata, false);\r\n    };\r\n\r\n    this.sendLocalMessage = function(metadata) {\r\n        saveMessage(metadata, true);\r\n    };\r\n\r\n    // All these functions accept another parameter called err,\r\n    // if numeric gte 0, will return an error message of that value.\r\n\r\n    this.getLastSession = function(err) {\r\n        if (typeof err === \"number\" && err >= 0) return errorMsgGenerator(err);\r\n\r\n        sessionId = sessionId ? sessionId : storage.getItem('SODA_LAST_SESSION');\r\n        if (!sessionId) return errorMsgGenerator(5);\r\n        return msgGenerator({sessionId : sessionId});\r\n    };\r\n\r\n    this.getUserDetails = function(err) {\r\n        if (typeof err === \"number\" && err >= 0) return errorMsgGenerator(err);\r\n        return msgGenerator(me);\r\n    };\r\n\r\n    this.getFriendsDetails = function(err) {\r\n        if (typeof err === \"number\" && err >= 0) return errorMsgGenerator(err);\r\n        return msgGenerator(contacts);\r\n    };\r\n\r\n    this.getLastKnownLocation = function(err) {\r\n        if (typeof err === \"number\" && err >= 0) return errorMsgGenerator(err);\r\n        return msgGenerator(location);\r\n    };\r\n\r\n    this.getUserPicture = function(userId, err) {\r\n        if (typeof err === \"number\" && err >= 0) return errorMsgGenerator(err);\r\n        var userPic = getUserPic(userId);\r\n        return (userPic === null) ? errorMsgGenerator(5) : msgGenerator(userPic);\r\n    };\r\n\r\n    this.getPayload = function(sessionId, err) {\r\n        if (typeof err === \"number\" && err >= 0) return errorMsgGenerator(err);\r\n        var res = {\"payload\": null};\r\n        if (payloads.hasOwnProperty(sessionId)) {\r\n            res.payload = payloads[sessionId];\r\n        }\r\n        return msgGenerator(res);\r\n    };\r\n\r\n    this.getContext = function(err) {\r\n        if (typeof err === \"number\" && err >= 0) return errorMsgGenerator(err);\r\n        return msgGenerator({\"context\": conversationId});\r\n    };\r\n\r\n    this.copyToClipboard = function(err) {\r\n        if (typeof err === \"number\" && err >= 0) return errorMsgGenerator(err);\r\n        return msgGenerator({});\r\n    };\r\n\r\n    this.openInExternalBrowser = function(url, err) {\r\n        if (typeof err === \"number\" && err >= 0) return errorMsgGenerator(err);\r\n        var windowId = window.open(url);\r\n        return msgGenerator({'windowId' : windowId});\r\n    };\r\n\r\n    this.getProductId = function() {\r\n        return '{\"result\":{\"productId\":\"123\"}}';\r\n    };\r\n\r\n    // Async\r\n    this.getCurrentLocationAsync = function(listener_name, err) {\r\n        if (typeof err === \"number\" && err >= 0) return errorMsgGenerator(err);\r\n        if (typeof listener_name !== \"function\") return errorMsgGenerator(\"callback function not supplied\");\r\n        that.setLastLocation(null, listener_name);\r\n    };\r\n\r\n    this.closeBubble = function() {\r\n        window.close();\r\n    };\r\n\r\n    ////////////// SDK functions end //////////////////////////////////////////\r\n\r\n    // Helper functions, not part of SDK:\r\n\r\n    // init - Used by SodaSandbox class to initialize it - Don't use.\r\n    this.init = function () {\r\n        var firstUser = \"Dima-123\";\r\n        var otherUser = \"Andrea-123\";\r\n        var mockItem = {\r\n            context: generateUUID(),\r\n            members: [{\r\n                userId: firstUser,\r\n                firstName: \"Dima\",\r\n                lastName: \"Nemetz\",\r\n                userName: \"diman\"\r\n            },{\r\n                userId: otherUser,\r\n                firstName: \"Andrea\",\r\n                lastName: \"Alkalay\",\r\n                userName: \"andrea\"\r\n            }],\r\n            userPictures: {}\r\n        };\r\n        mockItem.userPictures[firstUser] = {\r\n            type: \"base64\",\r\n            picture: \"data:image/jpeg;base64,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ueQC42ut2vLDoSOtilBMyx+R97XHS66mUvZYc9d1yu0k6Xv3WpBYbckO3QoEjmuaAbFvq05HdXJwDxr/ABOnZheISXqo2+h7jbO3p7qli5psW6G3NdYaiSlmbNC50cjTcPboQuxk4slZcuAXoY5Kp0ofDVzOlbK3UNJcbtPe6mbT5jGuzA3F9Duq24BxqlkoThVSPS4k+rmSpL+Km4drmQTuL6KU/wAt5/SehK0xao6mSHUEFzbe5WznuvYNvfULLHRzQBwN76gha/h3NF2vPpCkdKm8SMElpK9uJ07C2nqX5Xgfpf8A8/7pJR07G00dN11cOpVtYvhzcVw2akla0iRvpdbZw1BVQYY6VuOT00wyvgeWOHcbqqSpkGhhx6rbUVwgiaWxU7TGB3uS4/P7JlS3EmkYnWdpn/8AkkjRe/sqmVmBobhbuOmoPzWmlud1sed1w6jRZCwsg2N0OHRpAvc8ui3zkkZjoFzbveyCfVlB0vookzqCAL/G46rD7ZQ4Ek227LAcMwFhcdt10DQTlGovbMRogZ0pqt8cjHscQ5vfdX3wL4lVNDHSRYnK+ow6cZWvdq6Fw0IB5jt8l55JyusDdoNwplw3NJU4DiEN7/hy2aM9DzUkjh7BhnjqIWTRPbJG9oc1zTcEHYhKFQvhtxtLhWIR0FbO52HT6DMbiFx2I6Dqr5BBFwbhCJ//2SAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA=\"\r\n\r\n        };\r\n        mockItem.userPictures[otherUser] = {\r\n            type: \"image/jpeg\",\r\n            picture: \"http://lp.startapp.com/BreakTheIce/images/bar.jpeg\"\r\n        };\r\n\r\n        var paramUserId = getURLParameter('userId');\r\n        var paramContextId = getURLParameter('conversationId');\r\n        var currentUser = firstUser;\r\n        if (paramUserId && paramContextId){\r\n            currentUser = paramUserId;\r\n            conversationId = paramContextId;\r\n            var allConversations = decryptMsg(storage.getItem(\"SODA_conversations\"));\r\n            mockItem = allConversations[paramContextId];\r\n            var myNewUser = mockItem.members[0];\r\n            var redoMembers = mockItem.members.filter(function(elem){\r\n                if (elem.userId !== paramUserId) {\r\n                    return true;\r\n                } else {\r\n                    myNewUser = elem;\r\n                }\r\n            });\r\n            redoMembers.unshift(myNewUser);\r\n            mockItem.members = redoMembers;\r\n        }\r\n        that.mockContextAndMembers(mockItem);\r\n        var paramSessionId = getURLParameter('sessionId');\r\n        if (paramSessionId){\r\n            sessionId = paramSessionId;\r\n            var a = decryptMsg(storage.getItem(\"SODA_ITEM\"));\r\n            if (a && a.hasOwnProperty(paramSessionId) && a[paramSessionId].hasOwnProperty(currentUser)) {\r\n                payloads[paramSessionId] = a[paramSessionId][currentUser];\r\n            }\r\n        }\r\n        that.setLastLocation({\r\n            coords: {\r\n                accuracy: 1194,\r\n                altitude: null,\r\n                altitudeAccuracy: null,\r\n                heading: null,\r\n                latitude: 37.810977,\r\n                longitude: -122.477301,\r\n                speed: null\r\n            },\r\n            timestamp: Date.now()\r\n        });\r\n    };\r\n\r\n    // setLastLocation - Use this function with coords of your choice to alter the last location found.\r\n    this.setLastLocation = function (myLocation, cb) {\r\n        if (myLocation) {\r\n            location = myLocation;\r\n        } else {\r\n            if (navigator.geolocation) {\r\n                navigator.geolocation.getCurrentPosition(function (position) {\r\n                    location = position;\r\n                    if (typeof cb === 'function') cb(position);\r\n                });\r\n            }\r\n        }\r\n    };\r\n\r\n    // mockContextAndMembers - Use this function to dictate all meta objects:\r\n    //      ** context - Make it unique\r\n    //      ** members array - containing all the users in the conversation - The first one will be the user of this tab.\r\n    //      ** userPictures object - each key is a userId, each value an object of userPicture: {\"picture\": \"\"}.\r\n    this.mockContextAndMembers = function(details) {\r\n        if (details.context && details.members && details.members.length > 1) {\r\n            var context = details.context;\r\n            if (conversationId !== context){\r\n                var allConversations = decryptMsg(storage.getItem(\"SODA_conversations\")) || {};\r\n                if (!allConversations.hasOwnProperty(context)) {\r\n                    allConversations[context] = details;\r\n                    storage.setItem(\"SODA_conversations\", encryptMsg(allConversations));\r\n                }\r\n            }\r\n            conversationId = context;\r\n            me = details.members[0];\r\n            window.name = me.userId;\r\n            details.members.shift();\r\n            contacts = details.members;\r\n            userPictures = details.userPictures;\r\n        }\r\n    };\r\n}\r\n\r\nvar BubbleAPI = new SodaSandbox();\r\nBubbleAPI.init();\r\n\r\n//Export sandbox for package usage\r\nif (typeof module !== 'undefined' && module.exports) {\r\n    module.exports = BubbleAPI;\r\n}\r\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./~/soda-sandbox/soda_sandbox.js\n ** module id = 1\n ** module chunks = 0\n **/","module.exports = global[\"BubbleSdk\"] = require(\"-!C:\\\\work\\\\startappdev\\\\Other stuff\\\\services\\\\bubble_sdk\\\\node_modules\\\\babel-loader\\\\index.js?{\\\"presets\\\":[\\\"es2015\\\"]}!C:\\\\work\\\\startappdev\\\\Other stuff\\\\services\\\\bubble_sdk\\\\src\\\\bubble_sdk.js\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./src/bubble_sdk.js\n ** module id = 2\n ** module chunks = 0\n **/","\"use strict\";\r\n\r\nimport {SodaMessage} from \"./SodaMessage.class\";\r\nimport {parseJSON, generateUUID, b64ToUtf8} from './utils.js';\r\n\r\n//noinspection JSUnusedLocalSymbols\r\nmodule.exports = class BubbleSdk {\r\n    constructor() {}\r\n\r\n    static _extractResultFromJson(json) {\r\n        return new Promise((resolve, reject) => {\r\n            if (json.success && json.result) {\r\n                return resolve(json['result']);\r\n            } else {\r\n                if (json['result'] && json['result']['errorId']) {\r\n                    return reject(json['result']['errorId']);\r\n                } else {\r\n                    return reject(\"No result from BubbleApi\");\r\n                }\r\n            }\r\n        });\r\n    };\r\n\r\n    static _getPromisedValueFromSdk(field, call, args) {\r\n        return parseJSON(window.BubbleAPI[call](...args))\r\n            .then((sdkResultJson) => {\r\n                return this._extractResultFromJson(sdkResultJson);\r\n            })\r\n            .then((resultObj)=> {\r\n                if (field) {\r\n                    return resultObj[field];\r\n                } else {\r\n                    return resultObj;\r\n                }\r\n            });\r\n    }\r\n\r\n    static getMyLastSession(){\r\n        return this._getPromisedValueFromSdk('sessionId', 'getLastSession');\r\n    }\r\n\r\n    static closeBubble(){\r\n        return parseJSON(window.BubbleAPI.closeBubble());\r\n    }\r\n\r\n    static getContext(){\r\n        return this._getPromisedValueFromSdk('context', 'getContext');\r\n    }\r\n\r\n    static getPayload(sessionId){\r\n        return this._getPromisedValueFromSdk('payload', 'getPayload', [sessionId])\r\n            .then((base64Json) => {\r\n                if (base64Json === null) {\r\n                    return Promise.resolve(null);\r\n                } else {\r\n                    return b64ToUtf8(base64Json);\r\n                }\r\n            })\r\n            .then((jsonAsString) => {\r\n                return parseJSON(jsonAsString);\r\n            });\r\n    }\r\n\r\n    static createUniqueSessionIdIfOldNotFound(){\r\n        return this.getMyLastSession()\r\n            .catch(() => {\r\n                return Promise.resolve(generateUUID());\r\n        });\r\n    };\r\n\r\n    static getMessageInstance(sessionId){\r\n        return new SodaMessage(sessionId);\r\n    };\r\n\r\n    static getLastKnownLocation(){\r\n        return this._getPromisedValueFromSdk(null, 'getLastKnownLocation');\r\n    };\r\n\r\n    static copyToClipboard(url){\r\n        return this._getPromisedValueFromSdk(null, 'copyToClipboard', [url]);\r\n    };\r\n\r\n    static openInExternalBrowser(url){\r\n        return this._getPromisedValueFromSdk(null, 'openInExternalBrowser', [url]);\r\n    };\r\n\r\n    static getUserDetails(){\r\n        return this._getPromisedValueFromSdk(null, 'getUserDetails');\r\n    };\r\n\r\n    static getFriendsDetails(){\r\n        return this._getPromisedValueFromSdk(null, 'getFriendsDetails');\r\n    };\r\n\r\n    static getUserPicture(userId){\r\n        return this._getPromisedValueFromSdk('picture', 'getUserPicture', [userId]);\r\n    };\r\n\r\n    static getCurrentLocationAsync(cb){\r\n        window.BubbleAPI.getCurrentLocationAsync(cb);\r\n    };\r\n\r\n    static registerToPayloadEvent(cb){\r\n        window.setPayload = function(payload) {\r\n            try {\r\n                var jsonResult = JSON.parse(decodeURIComponent(window.atob(payload)));\r\n                cb(jsonResult, null);\r\n            } catch (e) {\r\n                cb(null, e);\r\n            }\r\n        };\r\n    };\r\n\r\n    static registerToBubbleClosedEvent(cb){\r\n        window.bubbleClosed = function() {\r\n            cb();\r\n        };\r\n    };\r\n};\r\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/bubble_sdk.js\n **/","\"use strict\";\r\n\r\nimport {stringifyJSON, isInArray} from './utils.js';\r\n\r\nexport class SodaMessage {\r\n    constructor(sessionId) {\r\n        // Mandatory message fields:\r\n        this.sessionId = sessionId;\r\n        this.priority = 2;\r\n\r\n        // Non mandatory fields:\r\n        this.payload = \"\";\r\n        this.updateMsg = false;\r\n        this.actionType = null;\r\n        this.title = null;\r\n        this.subTitle = null;\r\n        this.text = null;\r\n        this.iconUrl = null;\r\n        this.bannerUrl = null;\r\n        this.bubbleAppUrl = null;\r\n\r\n        // local vars for relaying problematic handling.\r\n        this.success = true;\r\n        this.msg = \"\";\r\n    }\r\n\r\n    toObject() {\r\n        let res = {};\r\n        for (let prop in this) {\r\n            if (this.hasOwnProperty(prop) && (!isInArray(prop, ['toObject', 'toString', 'success', 'msg'])) && (this[prop] !== null)) {\r\n                res[prop] = this[prop];\r\n            }\r\n        }\r\n\r\n        return res;\r\n    };\r\n\r\n    toString() {\r\n        return stringifyJSON(this.toObject())\r\n            .then((str)=>{\r\n                return str;\r\n        });\r\n    }\r\n}\r\n\r\nSodaMessage.prototype.setSessionId = function(sessionId) {\r\n    this.sessionId = sessionId;\r\n    return this;\r\n};\r\n\r\nSodaMessage.prototype.setPriority = function(priority) {\r\n    this.priority = priority;\r\n    return this;\r\n};\r\n\r\nSodaMessage.prototype.setPayload = function(payload) {\r\n    try {\r\n        var jsonAsBase64 = window.btoa(encodeURIComponent(JSON.stringify(payload)));\r\n        this.success = true;\r\n        this.payload = jsonAsBase64;\r\n    } catch (error) {\r\n        this.success = false;\r\n        this.msg = error.message;\r\n        this.payload = \"\";\r\n    } finally {\r\n        //noinspection ReturnInsideFinallyBlockJS\r\n        return this;\r\n    }\r\n};\r\n\r\nSodaMessage.prototype.setActionType = function(actionType) {\r\n    const ACTION_TYPES = [\"OPEN\", \"PLAY\", \"INSTALL\", \"ACCEPT\", \"DOWNLOAD\", \"PAY NOW\", \"SHOP NOW\", \"SIGN UP\", \"BOOK NOW\", \"VOTE\"];\r\n\r\n    if (actionType === null || isInArray(actionType, ACTION_TYPES)) {\r\n        this.actionType = actionType;\r\n    } else {\r\n        this.msg = \"No such action type\";\r\n        this.success = false;\r\n    }\r\n\r\n    return this;\r\n};\r\n\r\nSodaMessage.prototype.setTitle = function(title) {\r\n    this.title = title;\r\n    return this;\r\n};\r\n\r\nSodaMessage.prototype.setSubTitle = function(subTitle) {\r\n    this.subTitle = subTitle;\r\n    return this;\r\n};\r\n\r\nSodaMessage.prototype.setText = function(text) {\r\n    this.text = text;\r\n    return this;\r\n};\r\n\r\nSodaMessage.prototype.setIconUrl = function(iconUrl) {\r\n    this.iconUrl = iconUrl;\r\n    return this;\r\n};\r\n\r\nSodaMessage.prototype.setBannerUrl = function(bannerUrl) {\r\n    this.bannerUrl = bannerUrl;\r\n    return this;\r\n};\r\n\r\nSodaMessage.prototype.setBubbleAppUrl = function(bubbleAppUrl) {\r\n    this.bubbleAppUrl = bubbleAppUrl;\r\n    return this;\r\n};\r\n\r\nSodaMessage.prototype.setUpdateMsg = function(updateMsg) {\r\n    this.updateMsg = updateMsg;\r\n    return this;\r\n};\r\n\r\nSodaMessage.prototype.sendLocalMessage = function() {\r\n    return new Promise((resolve, reject)=>{\r\n        if (!this.success) return reject(new Error(this.msg));\r\n        stringifyJSON(this.toObject())\r\n            .then((metadata)=>{\r\n                window.BubbleAPI.sendLocalMessage(metadata);\r\n        });\r\n    });\r\n};\r\n\r\nSodaMessage.prototype.sendRemoteMessage = function() {\r\n    return new Promise((resolve, reject)=>{\r\n        if (!this.success) return reject(new Error(this.msg));\r\n        stringifyJSON(this.toObject())\r\n            .then((metadata)=>{\r\n                window.BubbleAPI.sendMessage(metadata);\r\n            });\r\n    });\r\n};\n\n\n/** WEBPACK FOOTER **\n ** ./src/SodaMessage.class.js\n **/","\"use strict\";\r\n\r\nexport function utf8ToB64(str) {\r\n    return new Promise((resolve, reject)=> {\r\n        try {\r\n            resolve(window.btoa(encodeURIComponent(str)));\r\n        } catch (e) {\r\n            reject(e);\r\n        }\r\n    });\r\n}\r\n\r\nexport function b64ToUtf8(str) {\r\n    return new Promise((resolve, reject)=> {\r\n        try {\r\n            resolve(decodeURIComponent(window.atob(str)));\r\n        } catch (e) {\r\n            reject(e);\r\n        }\r\n    });\r\n}\r\n\r\nexport function stringifyJSON(json) {\r\n    return new Promise((resolve, reject)=> {\r\n        try {\r\n            resolve(JSON.stringify(json));\r\n        } catch (e) {\r\n            reject(e);\r\n        }\r\n    });\r\n}\r\n\r\nexport function parseJSON(str) {\r\n    return new Promise((resolve, reject)=> {\r\n        try {\r\n            resolve(JSON.parse(str));\r\n        } catch (e) {\r\n            reject(e);\r\n        }\r\n    });\r\n}\r\n\r\nexport function generateUUID() {\r\n    let uuid;\r\n    let d = new Date().getTime();\r\n    //noinspection JSUnresolvedVariable\r\n    if (window.performance && typeof window.performance.now === \"function\") {\r\n        //noinspection JSUnresolvedVariable\r\n        d += window.performance.now(); //use high-precision timer if available\r\n    }\r\n    //noinspection SpellCheckingInspection\r\n    uuid = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {\r\n        let r = (d + Math.random() * 16) % 16 | 0;\r\n        d = Math.floor(d / 16);\r\n        return (c == 'x' ? r : (r & 0x3 | 0x8)).toString(16);\r\n    });\r\n    return uuid;\r\n}\r\n\r\nexport function isInArray(value, array) {\r\n    return array.indexOf(value) > -1;\r\n}\n\n\n/** WEBPACK FOOTER **\n ** ./src/utils.js\n **/"],"sourceRoot":""}